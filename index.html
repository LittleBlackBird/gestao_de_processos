<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de Gestão de Processos</title>
  <link rel="stylesheet" href="estilo_painel_processos.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
</head>
<body>
  <div class="painel">
    <h1>Painel de Gestão de Processos</h1>

    <div class="filtros">
      <div>
        <label for="unidade-select"><strong>Unidade:</strong></label>
        <select id="unidade-select">
          <option>Coordenação-Geral 1/GM</option>
          <option>Coordenação-Geral 2/GM</option>
          <option>Consultoria Jurídica</option>
        </select>
      </div>

      <div>
        <label for="tipo-processo-select"><strong>Tipo de Processo:</strong></label>
        <select id="tipo-processo-select"></select>
      </div>

      <div>
        <label for="processo-individual-select"><strong>Processo Individual:</strong></label>
        <select id="processo-individual-select"></select>
      </div>
    </div>

    <div class="grafico-indicadores" style="display: flex; gap: 20px; align-items: flex-start;">
      <div class="indicador" style="flex: 1;">
        <strong>Indicadores do Processo:</strong>
        <p id="tempo-restante">Tempo médio restante: -- dias</p>
        <ul id="etapas-lista">Etapas:</ul>
      </div>

      <div class="grafico-container" style="flex: 1;">
        <canvas id="graficoProcesso"></canvas>
      </div>
    </div>

    <div class="indicador">
      <strong>Relação com Estratégia:</strong>
      <div class="estrategia">
        <div>
          <label>Objetivo Estratégico:</label>
          <select>
            <option>1. Consolidar o Sistema Nacional de Cultura...</option>
            <option>10. Promover a apropriação social das tecnologias...</option>
            <option>12. Criar marcos e instrumentos legais...</option>
          </select>
        </div>

        <div>
          <label>Entrega Prioritária:</label>
          <select>
            <option>Ampliação dos programas especiais da Rouanet</option>
            <option>Brasil das Artes - Política Nacional das Artes</option>
            <option>Cessão “Casa de Afonso Arinos”...</option>
          </select>
        </div>
      </div>
    </div>

    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
      <div class="indicador" style="flex: 1;">
        <strong>Resumo da Unidade:</strong>
        <p id="resumo-unidade"></p>
      </div>

      <div class="indicador" style="flex: 1;">
        <strong>Relação com Macroprocessos:</strong>
        <p>--</p>
        <a href="#" class="link-manual">Acessar Manuais e Legislação</a>
      </div>
    </div>
  </div>

  <script>
    const estrutura = {
      "DIÁRIAS E PASSAGENS": [
        {
          "nome": "DIÁRIAS E PASSAGENS - Processo A",
          "concluidos": 3,
          "etapas": ["Etapa 1", "Etapa 2", "Etapa 3", "Etapa 4", "Etapa 5", "Etapa 6", "Etapa 7"]
        },
        {
          "nome": "DIÁRIAS E PASSAGENS - Processo B",
          "concluidos": 2,
          "etapas": ["Etapa 1", "Etapa 2", "Etapa 3", "Etapa 4", "Etapa 5", "Etapa 6", "Etapa 7"]
        }
      ],
      "TED": [
        {
          "nome": "TED - Processo A",
          "concluidos": 4,
          "etapas": ["Etapa 1", "Etapa 2", "Etapa 3", "Etapa 4", "Etapa 5", "Etapa 6", "Etapa 7"]
        },
        {
          "nome": "TED - Processo B",
          "concluidos": 1,
          "etapas": ["Etapa 1", "Etapa 2", "Etapa 3", "Etapa 4", "Etapa 5", "Etapa 6", "Etapa 7"]
        }
      ]
    };

    const tipoSelect = document.getElementById('tipo-processo-select');
    const processoSelect = document.getElementById('processo-individual-select');
    const ctx = document.getElementById('graficoProcesso').getContext('2d');
    const tempoRestante = document.getElementById('tempo-restante');
    const etapasLista = document.getElementById('etapas-lista');
    const resumoUnidade = document.getElementById('resumo-unidade');

    let chart;

    function atualizarTipos() {
      tipoSelect.innerHTML = '';
      Object.keys(estrutura).forEach(tipo => {
        const option = document.createElement('option');
        option.value = tipo;
        option.textContent = tipo;
        tipoSelect.appendChild(option);
      });
      atualizarProcessos();
    }

    function atualizarProcessos() {
      const tipo = tipoSelect.value;
      const processos = estrutura[tipo] || [];
      processoSelect.innerHTML = '';
      processos.forEach((proc, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = proc.nome;
        processoSelect.appendChild(option);
      });
      desenharGrafico();
      atualizarResumo();
    }

    function atualizarResumo() {
      const unidade = document.getElementById('unidade-select').value;
      const tipo = tipoSelect.value;
      const totalTipos = Object.keys(estrutura).length;
      let totalProcessos = 0;
      Object.values(estrutura).forEach(arr => totalProcessos += arr.length);

      resumoUnidade.textContent = `${unidade} possui 5 servidores, ${totalTipos} tipos de processos e ${totalProcessos} processos individuais.`;
    }

    function desenharGrafico() {
      const tipo = tipoSelect.value;
      const idx = processoSelect.value;
      const processo = estrutura[tipo][idx];
      const concluido = processo.concluidos;
      const total = processo.etapas.length;
      const restante = total - concluido;
      const percent = ((concluido / total) * 100).toFixed(1);

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Execução'],
          datasets: [
            { label: 'Concluído', data: [concluido], backgroundColor: '#00D000' },
            { label: 'Pendente', data: [restante], backgroundColor: '#FF0000' }
          ]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          plugins: {
            title: { display: true, text: `${processo.nome} - Execução: ${percent}%` },
            legend: { position: 'bottom' },
            datalabels: {
              anchor: 'center', align: 'center', color: '#fff',
              font: { weight: 'bold' },
              formatter: (value, ctx) => `${ctx.chart.data.datasets[ctx.datasetIndex].label}: ${value}`
            }
          },
          scales: {
            x: { stacked: true, max: total },
            y: { stacked: true }
          },
          animation: { duration: 1000, easing: 'easeOutQuart' }
        },
        plugins: [ChartDataLabels]
      });

      tempoRestante.textContent = `Tempo médio restante: ${restante * 5} dias`;
      etapasLista.innerHTML = processo.etapas.map((etapa, i) => `<li style="color:${i < concluido ? '#00D000' : '#FF0000'}">${etapa}</li>`).join('');
    }

    tipoSelect.addEventListener('change', atualizarProcessos);
    processoSelect.addEventListener('change', desenharGrafico);

    atualizarTipos();
  </script>
</body>
</html>
